<!DOCTYPE html>
<html>
<head>
	<title>Tech Community Rocks!</title>
	<link rel="Stylesheet" href="css/base.css" />
</head>
<body>
	<h1>Tech Community Rocks!</h1>
	<h2>User Groups</h2>
	<table id="UserGroups"></table>
	<div>
		<input type="button" onclick="ToggleJSON('UserGroupJSONDiv','UserGroupJSON',Groups);" value="Toggle JSON View" />
		<div id="UserGroupJSONDiv" class="Hidden" >
			<textarea id="UserGroupJSON" width="80" height="30"></textarea>
			<input type="button" onclick="JSONHandler('Groups','Refresh');" value="Refresh JSON From Table" />
			<input type="button" onclick="JSONHandler('Groups','Revert');" value="Reset JSON" />
			<input type="button" onclick="JSONHandler('Groups','Save')" value="Save JSON To Table" />
		</div>
	</div>
	<h2>Events</h2>
	<table id="Events"></table>
	<script type="text/javascript" src="data/Groups.js"></script>
	<script type="text/javascript" src="data/Events.js"></script>
	<script type="text/javascript" src="js/Sort.js"></script>
	<script type="text/javascript" src="js/HTMLEncode.js"></script>
	<script type="text/javascript" src="js/SimpleRender.js"></script>
	<script type="text/javascript">
		var OrigGroups = Groups;
		var OrigEvents = Events;
		function JSONHandler(ListType, Action)
		{
			var Data;
			if (ListType === "Groups")
			{
				TextAreaID = 'UserGroupJSON';
				if (Action === "Revert")
				{
					Data = OrigGroups;
				}
				else
				{
					Data = Groups;
				}
				TableID = 'UserGroups';
			}
			if (Action === "Save")
			{
				// for some reason, despite being passed by reference,
				// the Data parameter won't be set, so we have to
				// have it set via the return parameter
				Data = UpdateJSON(TextAreaID, Data, TableID);
			}
			else
			{
				PopJSON(TextAreaID, Data, TableID);
			}
			// for some reason, despite Data being set to them, the global
			// variables aren't affected by changes to Data, so set them here forcibly.
			if (ListType === "Groups")
			{
				Groups = Data;
			} 
		}
		function GetCurrentEvents()
		{
			return Events;
		}
		function ToggleClass(ID, ClassName)
		{
			var IsVisible = false;
			var obj = document.getElementById(ID);
			var ClassRegex = new RegExp("(?:^|\\s)" + ClassName + "(?!\\S)", "g");
			if (obj.className.match(ClassRegex))
			{
				obj.className = obj.className.replace(ClassRegex, "");
				IsVisible = true;
			}
			else
			{
				obj.className += " " + ClassName;
				IsVisible = false;
			}
			return IsVisible;
		}
		function ToggleJSON (JSONDivID, TextAreaID, Data)
		{
			var IsVisible = ToggleClass(JSONDivID, "Hidden");
			if (IsVisible)
			{
				PopJSON (TextAreaID, Data);
			}
		}
		function PopJSON (TextAreaID, Data)
		{
			document.getElementById(TextAreaID).value = JSON.stringify(Data);
		}
		function UpdateJSON (TextAreaID, Data, TableID)
		{
			Data = JSON.parse(document.getElementById(TextAreaID).value);
			DrawTable (Data, "Name", TableID);
			return Data;
		}
		function DrawTable(Data, SortCol, TableID)
		{
			MakeHTMLTableFromArray
			(
				Data.sort(dynamicSort(SortCol)),
				document.getElementById(TableID),
				true, // make header
				htmlEncode
			);
		}
		DrawTable(Groups, "Name", "UserGroups");
		DrawTable(Events, "Name", "Events");
	</script>
</body>
</html>